<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="Generator" content="Malte Kosian">
  <meta name="Author" content="Malte Kosian">
  <meta name="Keywords" content="adventure, game, story, story game, editor, simple, kiss, choice, yes, you can">
  <meta name="Description" content="a grid based linear story game with many choices">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>Grid Story Game</title>
  <style>
  body {background: #fff; margin: 0; overflow: hidden;font-family:sans-serif;font-size: 15px;}
  #grid-container { position:relative;width: 99%; max-width: 99%; }
  #grid-container:before { display: block;width: 99%; padding-top: 100%; }
  .grid { position:relative;float:left;background:#000;border:0;margin:0.5%;width:24%;height: 24%;}
  .grid-ready,.grid-end,.grid-element,.grid-start{ background:#ffc;margin: 10% 0 0 10%; width:76%;height: 76%;max-width:76%;max-height: 76%; padding: 2%; font-size: 12px;}
  button,input,select,option,.input {display: inline-block; margin: 1%; padding: 1%; border: 1px solid rgb(153, 153, 153); box-shadow: rgb(153, 153, 153) 1px 1px 0px inset, rgb(153, 153, 153) -1px -1px 0px inset; background: #ffc;border-radius: 8px;font-family:sans-serif;font-size:15px;}
  select,option,input,.input {max-width: 95%; min-width: 95%;}
  button:active,button:focus,select:active,input:active,.input:active,select:focus,input:focus,.input:focus {outline: 0;}
  button {padding: 1.5% 3%; }
  input[type=checkbox],input[type=radio]{max-width: 6%; min-width: 6%;}
  button:active,.input:active {background:#cc9;}
  .grid-start{background:#0c0;}
  .grid-end{background:#c00;}
  .grid-ready{background:#99c;}
  /*.grid-current{border-color:#f90;}*/
  .grid.current {background:#f90;}
  .grid:active, .grid:focus {background:#f90;}
  .prompt{position: absolute; left: 1%; top: 1%; min-width: 95%;max-width: 95%; min-height: 95%;max-height: 95%; padding: 1%; z-index: 100; display: block; overflow: auto; background: rgba(253,253,253,0.95); color: #000; box-shadow: inset 1px 1px 0px #999,inset 1px 1px 0px #999;border:1px solid #999;}
  .helptext {display: block; width: 94%; border: dotted 1px #ccc; font-size: 12px; margin-left: 1%; padding: 2%;};
  .closer,button.closer {font-weight: bold; color: #fff; background: #c00; width: 20%; min-width: 20%; max-width: 20%;}
  .menu button.input { width: 97%; min-width: 97%; padding: 3%; margin: 2% 1%; }
  .closer:hover,.closer:focus,.closer:active {background: #f00!important;}
  .canvas-container {display:none;position:absolute;top:0;left:0;width: 100%;max-width: 100%;height: 100%;max-height: 100%;}
  .menu {position: relative;background:#fff;height:100%;width:50%;max-width:50%;box-shadow:inset 0 1px 0 #999,0 2px 5px #000;border-right:solid 1px #999;}
  .menu-overlay {height:100%;width: 100%;max-width:100%;background: rgba(153,153,153,0.75);position: fixed;left: 0;top: 0;}
  .epicon{background:url(data:image/png;base64,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);background-size:cover/*contain*/;}
  /*.ingame-visible{display: block;}*/
 </style>
 <!--
 NEW create a play canvas
 and an HTML editor

 The title:
 Hurry, you are too late. To your job as quick as possible!
 The correct order:
 1  Wake and stand up in the morning.   showObject(16);
 2  Turn on the lights.                 showText('Say hello to the world!');showObject(3);showObject(8);
 3  Go to the kitchen.                  showObject(4);showObject(10);showObject(9);
 4  Open the water tap.                 showObject(5);showObject(6);
 5  Make coffee.                        showObject(14);
 6  Have breakfast.                     showObject(7);
 7  Put the dishes in the sink and close the tap.
 8  Go to the bath.                     showObject(12);
 9  Take a shower.                      showObject(13);
 10 Brush your teeth.                   showObject(11);
 11 Dry yourself off with the towel     showText('You really have to hurry now!')
 12 Don't panic!                        showObject(15);
 13 Get yourself dressed.
 14 Fetch the keys.
 15 Turn off the lights.
 16 Leave your home.
 -->
 <!--
 the dependencies:
 hasMissed:
 1 -> NOT possible!
 2 -> Seriously! You break your arms and legs. 5 years later someone will find your dead body. You will be reborn as yourself.
 3 -> no breakfast like 6.
 4 -> you can not have coffee without water. You are still dreaming. You are to late and you loose your job.
 5 -> like 6
 6 -> without a breakfast you will fall asleep again. You loose your job.
 7 -> your landlord will recall the contract, because of the water damage. So you have a very long day and have to stay in a hotel. Next day you'll loose your job, because you'll have overslept.
 8 -> you will miss 9,10,11...
 9 -> you stink. A good reason for your boss to fire you.
 10 -> your mouth stinks. A good reason for your boss to fire you.
 11 -> you get a cold. The very next day you loose your job, because your boss do not believes you.
 12 -> you are in panic, so 13, 14 and 15 takes place. You've lost the game and will be reborn as yourself.
 13 -> you are naked. The neighbor sees you and calls the police. After 5 years in the psychiatry you'll way to late.
 14 -> you will have to wait for the key service. You loose your job, because you are to late.
 15 -> the house will burn done. So you have a very long day and have to stay in a hotel. Next day you'll loose your job, because you'll have overslept.
 16 -> NOT possible.
 isSmaller:
 8 < 3 Bath before kitchen like -> 11.
 15 < 14 you do not take your keys. You have taken your mobile instead. Like -> 14
 13 < 12 You are in panic. like -> 13
 5 < 4 like -> 4
 -->
 <!--
 long story:
 stand up in the morning
 catch the bus and the underground (anyway you'll be late - if you do not take the bus you will walk to the u-station)
 loose your job and get the one as a game designer
 play the help file
 use the game's editor and write your own small game.
 -->
 <!--
 Even in pure linear story of a game the problem is how to dramatize the story,
 how to synchronize the events and what to reveal next.
 You have to give the player choices so the player can make mistakes.
 It is indeed all about mistakes, because the logical order is both inherit and
 explicit. The logical order is clear - afterwards. Only mistakes
 provide the challange to the player, the drama of the psychological conflict.
 -->
 <!--
 BUGS:

 TODOS:
 -> find a way to edit the evaluation tool, dependicies and the reporting output
    2 smaler 1 -> you made something in the wrong order

 make the complete tool canvas based
 build in uidcounter
 enable levels (transform game to level)
 enable level to level methods -> what will be the advanced features?
 game states and/or status-log
 build in mediamanager
 images, audios, translator
 object sizing and position
 DONE
 ?FIX? game.order must be reintialized after one play
 ?FIX? adding to order only once and NOT is if a object is only clicked(except the start object)
 fixed 2 out of 16 -> the length is way to short  (you left to early look for missed definitions)
 fixed 2 missed -> you did not do something (like leaving without key)
 fixed 2. define and detect cases -> show message - may loop to begining (rebirth after death)
 fixed evaluation on game.over for cases isSmaller and hasMissed
 fixed evaluation 1. game.over message and statistic evaluation
 fixed what to reveal next with showEvent code -> showObject, hideObject, showText(a message)
 fixed showObject set GameObject.active to true
 fixed GameObject.active if false not visible and playable
 fixed added Game method for mouse|touch Game.init and update and Game.draw
 fixed bug with Game.prototype.load method in editor.loadGame method
 fixed need to load the stuff on start AND update the layout/editor view indeed!
 fixed ask for the quest on start up. SHOW the quest and the title!
 fixed output layout
 fixed output updates
 -->
 </head>
 <body>
  <script>
  (function(win) {
    /**
    @class MediaLanguage
    @param _lan
    @since 2014-05-18
    */
    function MediaLanguage(_lan) {
      /**
      @attribute language
      */
      this.language = _lan;
      /**
      @property medias
      */
      this.medias = [];
      /**
      @method load
      @param data
      @since 2014-05-29
      */
      this.load = function(data) {
      this.language = data['language'];
      this.medias = [];
      for (var i = 0; i < data['medias'].length; i++) {
       this.medias.push({ key:data['medias'][i]['key'], value:data['medias'][i]['value']});
      }
      };
      /**
      _t64 indicates if the value has to be base64_encoded or not
      @method setMedia
      @since 2014-05-15
      @param _k the key
      @param _v the value
      @param {boolean} _t64 to be 64 encoded
      */
      this.setMedia = function(_k, _v, _t64) {
      //console.log('setMedia'+_k);
      if (this.hasMedia(_k)) {
       this.getMedia(_k).value = _t64 ? btoa(_v): _v;
      } else {
       this.addMedia(_k, _v, _t64);
      }
      };
      /**
      use this to get Images, Audios, Videos and other
      media that should stay bas64 encoded
      var myMediaValue = [..].getMedia('key').value;
      @method getMedia
      @since 2014-05-15
      @param _k the key
      @return the complete media Object
      */
      this.getMedia = function(_k) {
        for (var i = 0; i < this.medias.length; i++) {
          if (this.medias[i].key == _k) {
            return this.medias[i];
          }
        }
        return null;
      };
      /**
      Don't use this method for images, audios or videos,
      because those have to stay base64_encoded
      @method getTextMedia
      @since 2014-05-15
      @param _k the key
      @return the media value - always base64 decoded
      */
      this.getTextMedia = function(_k) {
        for (var i = 0; i < this.medias.length; i++) {
          if (this.medias[i].key == _k) {
            //console.log('getMedia->'+atob(this.medias[i].value));
            return atob(this.medias[i].value);
          }
        }
        return null;
      };
      /**
      @method hasMedia
      @since 2014-05-15
      @param _k the key
      @return {boolean} true if the media with the key exists
      */
      this.hasMedia = function(_k, _v) {
        for (var i = 0; i < this.medias.length; i++) {
          if (this.medias[i].key == _k) {
            return true;
          }
        }
        return false;
      };
      /**
      @method deleteMedia
      @since 2014-05-16
      @param _k the key
      */
      this.deleteMedia = function(_k, _v) {
        for (var i = 0; i < this.medias.length; i++) {
          if (this.medias[i].key == _k) {
            return this.medias.splice(i, 1);
          }
        }
      };
      /**
      @method addMedia
      @since 2014-05-15
      @param _k the key
      @param _v the value
      @param {boolean} _t64 to be 64 encoded
      */
      this.addMedia = function(_k, _v, _t64) {
        this.medias.push(this.createMedia(_k, _v, _t64));
      };
      /**
      @method createMedia
      @since 2014-05-15
      @param _k the key
      @param _v the value
      @param {boolean} _t64 to be 64 encoded
      @return the media Object
      */
      this.createMedia = function(_k, _v, _t64) {
        _v = _t64 ? btoa(_v): _v;
        return { key : _k, value : _v };
      };
    };
    var Game = function(){};
    Game.prototype.start = null;
    Game.prototype.end = null;
    Game.prototype.objects = [];
    /*
    {priority: 0, method:'isSmaller', text: 'show this text', params: [a,b]}
    {priority: 1, method:'hasMissed', text: 'show this text because of the higher priority', params: [a]}
    */
    Game.prototype.dependencies = [];
    Game.prototype.current = null;
    Game.prototype.order = [];
    Game.prototype.title = null;
    //maybe the quest will be an object instead of a simple string
    //so the quest will be validated in the end of the level/game
    Game.prototype.quest = null;
    Game.prototype.over = false;
    Game.prototype.menuMode = false;
    Game.prototype.mousetime = null;
    /**
    @method getObject
    @param id the id of the object
    @return the object
    */
    Game.prototype.getObject = function(id) {
      var objects = this.objects;
      for (var i = 0; i < objects.length; i++)
      {
        if (objects[i].id==id)
        {
          return objects[i];
        }
      }
      return null;
    };
    /**
    activate the Object and make it always visible
    @method showObject
    @param id the id of the object
    */
    Game.prototype.showObject = function(id) {
      var obj = this.getObject(id);
      console.log('showObject->',id,obj);
      obj.visible = true;
      obj.active = true;
      //game.currentText = null;
    };
    /**
    hide the Object complete
    it is deactivated and invisble
    @method hideObject
    @param id the id of the object
    */
    Game.prototype.hideObject = function(id) {
      var obj = this.getObject(id);
      obj.visible = false;
      obj.active = false;
      //game.currentText = null;
    };
    /**
    make the object visible
    the object will stay active or deactivated
    @method makeVisible
    @param id the id of the object
    */
    Game.prototype.makeVisible = function(id) {
      var obj = this.getObject(id);
      obj.visible = true;
    };
    /**
    the object is invisible
    but it will stay active or deactivated
    @method makeInvisible
    @param id the id of the object
    */
    Game.prototype.makeInvisible = function(id) {
      var obj = this.getObject(id);
      obj.visible = true;
    };
    /**
    display the given text
    @method showText
    @param text display the given text
    */
    Game.prototype.showText = function(text) {
      //displays the text on the canvas
      //canvas and ctx are attached to the window
      console.log('showText='+atob(text));
      game.currentText = atob(text);
    };
    /**
    a dependencies method
    if the order of a is smaller than the order of b
    @method isSmaller
    @param a
    @param b
    */
    Game.prototype.isSmaller = function(a, b) {
     //code here
    };
    /**
    a dependencies method
    if you have missed the object specified by id
    @method hasMissed
    @param a
    */
    Game.prototype.hasMissed = function(a) {
     //code here
    };
    /**
    follows touch and mouse event
    @method mousePressed
    @param x the x coordinate real value//in 0 to 1 .
    @param y the y coordinate real value //in 0 to 1 .
    */
    Game.prototype.mousePressed = function(x,y) {
      console.log(pressed);
      if (!pressed)
      {
        pressed = true;
        var obj = null;
        console.log('pressed->y='+y+',x='+x+',yo=');
        for (var i = 0; i < game.objects.length; i++) {
          obj = game.objects[i];
          if (obj.pointHits(x,y) && obj.active) {
            //find the current object
            game.current = obj;
          }
        }
        px = x;
        py = y;
        mx = x;
        my = y;
        if (game.current == null) {
          //this.mousetime = setTimeout(function() { game.showMenu(); }, 1000);
        }
        update = true;
      }
    };
    /**
    follows touch and mouse event
    @method mouseMoved
    @param x the x coordinate .
    @param y the y coordinate //in 0 to 1 .
    */
    Game.prototype.mouseMoved = function(x,y) {
      if (pressed)
      {
        if (game.current != null)
        {
          //var yo = y;
          game.current.x += x/canvas.width-game.current.x;
          game.current.y += y/canvas.width-game.current.y;
          update = true;
        }
      }
    };
    /**
    follows touch and mouse event
    @method mouseReleased
    @param x the x coordinate //in 0 to 1 .
    @param y the y coordinate //in 0 to 1 .
    */
    Game.prototype.mouseReleased = function(x,y) {
      console.log('released->pressed='+pressed,x,y);
      if (pressed)
      {
        console.log(x,y);
        if (!game.menuMode) {
        //game.menumode false|true
          //if (game.mousetime != null) {
          //  clearTimeout(game.mousetime);
          //  game.mousetime = null;
          //}
          if (x < 52 && y < 52) {
            game.menuMode = true;
            px = 0;
            py = 0;
            mx = 0;
            my = 0;
            pressed = false;
            update = true;
            return;
          }
          if (!game.over) {

            if (game.current != null && game.start != null && (
                (game.current.id != game.start &&
                game.getObject(game.start).pointHits(game.current.x*canvas.width+game.current.w*canvas.width/2, game.current.y*canvas.width+game.current.h*canvas.width/2)) ||
                (game.end != null && game.current.id == game.start &&
                game.getObject(game.end).pointHits(game.current.x*canvas.width + game.current.w*canvas.width/2, game.current.y*canvas.width+game.current.h*canvas.width/2))
               ))
            {
              console.log(game.start+'-'+game.current.id,game.getObject(game.start));
              if (game.current.id == game.start &&
                 game.getObject(game.end).pointHits(game.current.x*canvas.width+game.current.w*canvas.width/2, game.current.y*canvas.width+game.current.h*canvas.width /2)
                 )
              {
                game.current = game.getObject(game.end);
              }
              if (game.order.indexOf(game.current.id) < 0) {
                game.order.push(game.current.id);
              }
              game.current.active = false;
              game.current.visible = false;
              if (game.current.events != null) {
                game.current.getEvent();
              }
              if (game.current.id == game.end) {
                game.over = true;
              }
            } else if (game.current != null && game.current.id == game.start &&
                       game.getObject(game.start).pointHits(game.current.ox*canvas.width+game.current.w*canvas.width/2, game.current.oy*canvas.width+game.current.h*canvas.width/2)
                      )
            {
              if (game.order.indexOf(game.current.id) < 0) {
                game.order.push(game.current.id);
              }
              if (game.current.events != null) {
                game.current.getEvent();
              }
            } else if (game.current != null)
            {
              game.current.x = game.current.ox;
              game.current.y = game.current.oy;
            }
          } else {

          }
        } else {
          //M E N U M O D E
          var cw = canvas.width;
          var fts = Math.round( (((canvas.height - cw) / 2) / 5) );
          console.log('game - menumode '+x+', '+y);
          if (x < cw / 2 && y > 54 && y < 52 + 2 * fts) {
            //game.stopGame();
            console.log('stopGame '+y);
            px = 0;
            py = 0;
            mx = 0;
            my = 0;
            game.current = null;
            pressed = false;
            editor.stopGame();
          } else
          if (x < cw / 2 && y > 54 + 2 * fts && y < 52 + 4 * fts) {
            console.log('restartGame '+y);
            px = 0;
            py = 0;
            mx = 0;
            my = 0;
            game.current = null;
            pressed = false;
            update = true;
            //game.restartGame();
          } else
          if ((x > cw / 2 - 50 && y < 50) || (x > cw / 2) ) {
            console.log('close menu '+x+', '+y);
            game.menuMode = false;
            update = true;
          }
        }
        px = 0;
        py = 0;
        mx = 0;
        my = 0;
        game.current = null;
        pressed = false;
        update = true;
      }
    };
    /**
    used by editor.playGame this to start a game
    use editor.stopGame to finish the game
    @method init
    */
    Game.prototype.init = function() {
      var obj = null;
      var pheight = ((canvas.height - canvas.width)/2) / canvas.width;
      for (var i = 0; i < 4; i++)
      {
        for (var j = 0; j < 4; j++)
        {
          obj = game.getObject('o_'+i+'_'+j);
          obj.x = 0.04 + j * 0.24;//canvas.width/40 + j * canvas.width/4.5;
          obj.y = 0.04 + i * 0.24 + pheight;//canvas.width/8 + i * canvas.width/4.5;
          obj.w = obj.h = 0.2;//canvas.width/6;
          obj.ox = obj.x;
          obj.oy = obj.y;
          obj.visible = true;
        }
      }
      game.over = false;
      update = true;
      //requestAnimationFrame(function() { game.updateGraphics(); });
    };
    /*
    Game.prototype.updateGraphics = function() {
      if (update)
      {
        update = false;
        game.draw();
      }
      requestAnimationFrame(function() { game.updateGraphics(); });
    };**/
    /**
    formats the text onliner in a readable and screen fitting text array
    @method formatText
    @param the text to format
    @return the line formated text-array
    */
    Game.prototype.formatText = function(text) {
      var ctext = [];
      var line = '';
      text = text.split(' ');
      for (var i = 0; i < text.length; i++)
      {
        if (ctx.measureText(line+' '+text[i]).width <= canvas.width * 0.9)
        {
          if (line.length > 0) {
            line = line+' '+text[i];
          } else {
            line = text[i];
          }
        } else {
          ctext.push(line);
          line = text[i];
        }
      }
      //push the last line here and now ->
      ctext.push(line);
      console.log('ctext -> ',ctext);
      return ctext;
    };
    /**
    @method getDependency
    */
    Game.prototype.getDependency = function(method, obj_id) {
      var depend = null;
      for (var i = 0; i < this.dependencies.length; i++) {
        depend = this.dependencies[i];
        if (depend.method != null && depend.method == method &&
            depend.params.length > 0 && depend.params[0] == obj_id)
        {
          return depend;
        }
      }
      return null;
    }
    /**
      @class mediamanager
      @since 2014-05-18
    */
    Game.prototype.mediamanager = {
      /**
      @property defaultLananguage
      @default 'en'
      */
      defaultLanguage : 'en',
      /**
      @property currentLanguage
      @default 'en'
      */
      currentLanguage : 'en',
      /**
      @property {array} languages
      */
      languages : [],
      /**
      @property {array} mediaLanguages
      */
      mediaLanguages : [],
      /**
      @method setCurrentLanguage
      */
      setCurrentLanguage : function(_lan) {
        this.currentLanguage = _lan;
        if (!this.hasLanguage(_lan)) {
          this.addLanguage(_lan);
        }
      },
      /**
      @method addLanguage
      */
      addLanguage : function(_lan) {
        this.mediaLanguages.push( new MediaLanguage(_lan) );
        this.languages.push(_lan);
      },
      /**
      @method hasLanguage
      */
      hasLanguage : function(_lan) {
        for (var i = 0; i < this.languages.length; i++) {
          if (this.languages[i] == _lan) {
            return true;
          }
        }
        return false;
      },
      /**
      @method getLanguage
      @since 2014-07-31
      @param _lan a language key like 'en','de',...
      @return {MediaLanguage} a mediaLanguage or null
      */
      getLanguage : function(_lan) {
        for (var i = 0; i < this.mediaLanguages.length; i++) {
          if (this.mediaLanguages[i].language == _lan) {
            return this.mediaLanguages[i];
          }
        }
        return null;
      },
      /**
      @method getCurrentLanguage
      */
      getCurrentLanguage : function() {
        for (var i = 0; i < this.mediaLanguages.length; i++) {
          if (this.mediaLanguages[i].language == this.currentLanguage) {
            return this.mediaLanguages[i];
          }
        }
        this.currentLanguage = this.defaultLanguage;
        var language = new MediaLanguage(this.currentLanguage);
        this.mediaLanguages.push( language );
        this.languages.push(this.currentLanguage);
        return language;
      },
      /**
      returns the keys, defined by the default language
      @method getKeys
      @since 2914-07-31
      @return {Array} keys
      */
      getKeys : function () {
        var d_lan = this.getLanguage(this.defaultLanguage);
        var keys = [];
        for (var i = 0; i < d_lan.medias.length; i++) {
          //console.log(d_lan.getMedia(d_lan.medias[i].key).value.substr(0, 20));
          if (!(d_lan.getMedia(d_lan.medias[i].key).value.indexOf('data:') == 0 &&
              d_lan.getMedia(d_lan.medias[i].key).value.indexOf('base64') > 0))
          {
            keys.push(d_lan.medias[i].key);
          }
        }
        return keys;
      },
      /**
      use getTextMedia too get the decoded media value
      @method setTextMedia
      @since 2014-05-17
      @param _k the key
      @param _v the value
      */
      setTextMedia : function(_k, _v) {
        //type64=true|false would regulate de/encoding or not
        for (var i = 0; i < this.mediaLanguages.length; i++) {
          if (this.mediaLanguages[i].getMedia(_k) == null) {
            this.mediaLanguages[i].setMedia(_k, _v, true);
          }
        }
      },
      /**
      push through for MediaLanguage.setMedia
      the media will not be base64 encoded
      use getMedia too get the media
      use for Images and other natually base64 encoded media
      @method setMedia
      @since 2014-05-29
      @param _k the key
      @param _v the value - already base64 encoded
      */
      setMedia : function(_k, _v) {
        //type64=true|false would regulate de/encoding or not
        for (var i = 0; i < this.mediaLanguages.length; i++) {
          if (this.mediaLanguages[i].getMedia(_k) == null) {
            this.mediaLanguages[i].setMedia(_k, _v, false);
          }
        }
      },
      deleteMedia : function(_k) {
        for (var i = 0; i < this.mediaLanguages.length; i++) {
          this.mediaLanguages[i].deleteMedia(_k);
        }
      },
      getMedia : function(_k) {
        return this.getCurrentLanguage().getMedia(_k);
      },
      getTextMedia : function(_k) {
        return this.getCurrentLanguage().getTextMedia(_k);
      },
      /**
      @method load
      @param data
      @since 2014-05-29
      */
      load : function(data) {
        this.defaultLanguage = 'en',
        this.currentLanguage = data['currentLanguage'];
        this.languages = data['languages'];
        this.mediaLanguages = [];
        for (var i = 0; i < data['mediaLanguages'].length; i++) {
          var lan = new MediaLanguage(data['mediaLanguages'][i]['uid']);
          lan.load(data['mediaLanguages'][i]);
          this.mediaLanguages.push(lan);
        }
      }
    };
    /*
    Game.prototype.showMenu = function() {
      game.menuMode = true;
      update = true;
    }
    **/
    /**
    @method draw
    */
    Game.prototype.draw = function() {
      var cw = canvas.width;
      var ch = canvas.height;
      ctx.fillStyle = '#f8faff';
      ctx.fillRect(0,0,cw,ch);
      ctx.fillStyle = '#000';
      var fts = Math.round( (((ch - cw) / 2) / 5) );
      ctx.font = fts+'px Sans-Serif';
      var objects = game.objects;
      var obj = null;
      var menuImg = new Image();
      menuImg.src = menuicon;
      ctx.drawImage(menuImg, 0, 0, 50, 50);
      if (game.over)
      {
        ctx.fillText(''+atob(game.title),0.02*cw,(0.01*ch+fts)*1);
        ctx.fillText('statistics:',0.02*cw,(0.01*ch+fts)*2);
        var missed = objects.length - game.order.length;
        if (missed > 0)
        {
          //ctx.fillText('You have missed '+missed+' step'+(missed>1 ? 's':''),0.02*cw,(0.01*cw+fts)*3);
          var cprior = 0;
          var ctext = [];
          for (var i = 0; i < objects.length; i++) {
            obj = objects[i];
            if (game.order.indexOf(obj.id) < 0)
            {
              console.log(obj.id);
              ctx.fillStyle = '#c00';
              //ctx.fillText(obj.id+' '+obj.order,0.02*cw,(0.01*cw+fts)*(4+i));
              var dep = game.getDependency('hasMissed',obj.id);
              if (dep != null && cprior < dep.priority) {
                cprior = dep.priority;
                ctext = game.formatText(atob(dep.text));
              }
            }
          }
          //hasMissed
          for (var j = 0; j < ctext.length; j++) {
            ctx.fillText(ctext[j],0.02*cw,(0.01*ch+fts)*(4+j));
          }
        } else {
          var cprior = 0;
          var ctext = [];
          for (var i = 0; i < game.order.length; i++) {
            obj = game.getObject(game.order[i]);
            console.log(obj);
            if (obj.order == 1 || (i >= 1 && obj.order > game.getObject(game.order[i-1]).order)) {
              ctx.fillStyle = '#0c0';
            } else {
              ctx.fillStyle = '#c00';
              var dep = game.getDependency('isSmaller',obj.id);
              console.log(dep);
              if (dep != null && cprior < dep.priority) {
                cprior = dep.priority;
                ctext = game.formatText(atob(dep.text));
              } else {
                ctx.fillText(obj.id+' '+obj.order,0.02*cw,(0.01*ch+fts)*(3+i));
              }
            }
          }
          //isSmaller
          ctx.fillStyle = '#c00';
          for (var j = 0; j < ctext.length; j++) {
            ctx.fillText(ctext[j],0.02*cw,(0.01*ch+fts)*(4+j));
          }
        }
      } else {
        //game play
        ctx.fillText(''+atob(game.title),0.02*cw,ch/3*2+0.01*ch+fts);
        ctx.fillText(''+atob(game.quest),0.02*cw,ch/3*2+(0.01*ch+fts)*2);
        //begin of btx context
        ctx.lineWidth = 0.025 * cw;
        //the position height
        var pheight = (ch - cw) / 2; 
        //
        for (var i = 0; i < objects.length; i++)
        {
          obj = objects[i];
          if (obj.visible) {
            if (obj.id == game.start)
            {
              ctx.fillStyle = '#0c0';
              ctx.strokeStyle = '#000';
            } else if (obj.id == game.end)
            {
              if (obj.active)
              {
                ctx.fillStyle = '#c00';
                ctx.strokeStyle = '#000';
              } else {
                ctx.fillStyle = 'rgba(204,51,51,0.5)';
                ctx.strokeStyle = 'rgba(51,51,51,0.5)';
              }
            } else if (obj.active)
            {
              ctx.fillStyle = '#99c';
              ctx.strokeStyle = '#000';
            } else {
              ctx.fillStyle = 'rgba(128,128,128,0.5)';
              ctx.strokeStyle = 'rgba(51,51,51,0.5)';
            }
            if (game.current != null && obj.id == game.current.id) {
              ctx.strokeStyle = '#f90';      
            } else {
              ctx.fillRect(obj.x * cw, obj.y * cw, obj.w * cw, obj.h * cw);
              ctx.strokeRect(obj.x * cw, obj.y * cw, obj.w * cw, obj.h * cw);
            }
          }
        }
        //finally draw the current object.
        if (game.current != null) {
          obj = game.current;
          //if (obj.active) {
          ctx.fillStyle = '#99c';
          //}
          if (obj.id == game.end) {
            ctx.fillStyle = '#c00';
          }
          ctx.strokeStyle = '#f90';
          ctx.fillRect(obj.x * cw, obj.y * cw, obj.w * cw, obj.h * cw);
          ctx.strokeRect(obj.x * cw, obj.y * cw, obj.w * cw, obj.h * cw);
        }
        //end of btx context
        ctx.fillStyle = '#000';
        var fts = Math.round( (((ch - cw) / 2) / 5) );
        ctx.font = fts+'px Sans-Serif';
        console.log('fts => '+fts);
        ctx.fillText(''+atob(game.title),0.02*cw,fts*1.1);
        ctx.fillText(''+atob(game.quest),0.02*cw,fts*2.2);
        if (game.current != null) {
          ctx.fillText(''+game.current.getText(),0.02*cw,ch/3*2+(0.01*ch+fts)*3);
        } else if (game.order.length > 0) {
          var j = 0;
          for (var i = game.order.length - 1; i >= (game.order.length > 2 ? game.order.length-3 : 0); i--) {
            ctx.fillText(''+game.getObject(game.order[i]).getText(),0.02*cw,
                   ch/3*2+(0.01*ch+fts)*((game.order.length > 2 ? 3 : game.order.length)+(2-j)));
            j++;
          }
          if (game.currentText!= null) {
            ctx.fillText(''+game.currentText,0.02*cw,ch/3*2+(0.01*ch+fts)*6.25);
          }
        }
        //menumode
        if (game.menuMode) {
          ctx.fillStyle = 'rgba(0,0,0,0.5)';
          ctx.fillRect(0,0,cw, ch);
          ctx.fillStyle = '#fff';
          ctx.fillRect(0, 0, cw/2, ch);
          ctx.drawImage(menuImg, cw/2 - 52, 0, 50, 50);
          ctx.fillStyle = '#000';
          ctx.fillRect(0, 52, cw/2, 2);
          ctx.fillText('stop Game', 5, 52 + fts * 1.5);
          ctx.fillRect(0, 52 + fts * 2, cw/2, 2);
          ctx.fillText('restart', 5, 52 + fts * 3.5);
          ctx.fillRect(0, 52 + fts * 4, cw/2, 2);
        }
      }
    };
    var mx = 0;
    var my = 0;
    var px = 0;
    var py = 0;
    var pressed = false;
    /**mend = mouse end fire only once*/
    var mend = false;
    var update = false;
    var body = document.body;
    var store = localStorage;
    var menuMode = false;
    var gmode = 'editor';
    var bufferImg = null;
    var btx = null;
    var mouseTimer = null;
    var canvas = null;
    var ctx = null;
    /**
    short for document.getElement
    @method getElement
    @param t the id
    @return the HTMLdomObject
    */
    win.getElement = function(t){
      return document.getElementById(t);
    };
    /**
    short for document.createElement
    @method createElement
    @param t the descriptor of the tag|the tag
    @return the HTMLdomObject
    */
    function createElement(t){
      return document.createElement(t);
    };
    /**
    short for document.createTextNode
    @method createTextNode
    @param t the text
    @return the HTMLdomTextNode
    */
    function createTextNode(t){
      return document.createTextNode(t);
    };

    /**
    @class GameObject
    */
    var GameObject = function (_id, _t) {
      this.text = btoa(_t);
      this.order = 0;
      this.id = _id;
      //this.event = null;
      this.events = [];
      this.active = false;
      this.visible = true;
      this.x = 0;
      this.y = 0;
      this.ox = 0;
      this.oy = 0;
      this.w = 0;
      this.h = 0;
      /**
      call callback function with window, game as parameters
      @method getEvent
      @return the callback function (¿ returns the return value or null ?)
      */
      this.getEvent = function() {
        /*if (this.event == null){
          return null;
        }*/
        try {
          game.currentText = null;
          console.log(this.events);
          for (var i = 0; i < this.events.length; i++) {
            console.log(this.events[i].method,this.events[i].values);
            switch (this.events[i].values.length) {
              case 1:
              game[this.events[i].method](this.events[i].values[0]);
              break;
              case 2:
              game[this.events[i].method](this.events[i].values[0],
              this.events[i].values[1]);
              break;
              case 3:
              game[this.events[i].method](this.events[i].values[0],
              this.events[i].values[1],this.events[i].values[2]);
              break;
              case 4:
              game[this.events[i].method](this.events[i].values[0],
              this.events[i].values[1],this.events[i].values[2],
              this.events[i].values[3]);
              break;
              case 5:
              game[this.events[i].method](this.events[i].values[0],
              this.events[i].values[1],this.events[i].values[2],
              this.events[i].values[3],this.events[i].values[4]);
              break;
              default:
              game[this.events[i].method]();
              break;
            }
          }
        } catch(ex) {
          console.log(ex);
        }
        //return new Function('window,game',atob(this.event));
      }
      /**
      @method setEvent
      @param action the action to be performed on the clicked|touched|selected event
      */
      this.setEvent = function(code) {
        /*var events = btoa(_code).split(',');
        for (var i = 0; i < this.events.length; i++)
        {
          console.log(this.event[i][0],this.event[i][1].replace(/)/,''));
          //this.events.push(new GameEvent(this.event[i][0],this.event[i][1].replace(/)/,'')););
        }*/
        //this.event = new GameEvent(this.event[0],this.event[1].replace(/)/,''));
        this.events.push(new GameEvent(action['method'],action['values']));
      }
      /**
      @method getText
      */
      this.getText = function() {
        return atob(this.text);
      }
      /**
      @method setText
      */
      this.setText = function(_t) {
        this.text = btoa(_t);
      };
      /**
      @method load
      */
      this.load = function(data) {
        this.text = data['text'];
        this.order = parseInt(data['order']);
        this.id = data['id'];
        //this.event = data['event']==null?null:atob(data['event']);
        this.events=[];
        if (typeof data['events'] != 'undefined')
        for (var i = 0; i < data['events'].length; i++) {
          this.events.push(new GameEvent(data['events'][i]['method'],data['events'][i]['values']));
        }
        /*if (this.event != null)
        {

          //console.log(this.event.split(';'));
          var events = this.event.split(';');
          for (var i = 0; i < (events.length-1); i++)
          {
            events[i] = events[i].split('(');
            var values = events[i][1].replace(/\)/,'').replace(/\'/g,'').split(',');
            if (events[i][0]=='showText') {
              values[0]=btoa(values[0]);
            }
            this.events.push(new GameEvent(events[i][0],values));
          }
        }*/
        //this.event = btoa(this.event);
        this.active = typeof data['active'] == 'undefined' ? false : data['active'];
        this.x = data['x'];
        this.y = data['y'];
        this.ox = data['x'];
        this.oy = data['y'];
        this.w = data['w'];
        this.h = data['h'];
      };
      /**
      @method pointHits
      */
      this.pointHits = function(x, y) {
        return (this.x * canvas.width <= x && this.y * canvas.width <= y && this.x * canvas.width + this.w * canvas.width >= x && this.y * canvas.width + this.h * canvas.width >= y);
      }
    };
    /**
    @class GameEvent
    */
    var GameEvent = function(method, values) {
      this.method = method;
      this.values = values;
    };
    /**
    @class GameDependency
    {priority:'',method:'',params:[]}
    */
    var GameDependency = function(p, method) {
      this.priority = p;
      this.method = method;
      this.text = null;
      this.params = [];//the referenced object by obj_id
      this.event = null; //not used in the moment
      /**
      @method getText
      @return the b64decoded text
      */
      this.getText = function () {
        return atob(this.text);
      };
      /**
      @method setText
      @param text encodes the text base64
      */
      this.setText = function (text) {
        this.text = btoa(text);
      };
      /**
      @method load
      @param data
      */
      this.load = function(data) {
        this.priority = data['priority'];
        this.method = data['method'];
        this.params = data['params'];
        this.text = data['text'];
        if (data['event'] != null) {
          this.event = new GameEvent(data['event']['method'],data['event']['value']);
        } else {
          this.event = null;
        }
      };
    };
    /***/
    //var game = new Game();
    //for debug purpose only
    win.game = new Game();
    //end debug
    /***/
    var editor = {};
    editor.mode = '';
    editor.current = null;
    editor.oldGame = null;
    /**
    @method showMenu
    */
    editor.showMenu = function() {
      if (getElement('menu-overlay') != null) {
        body.removeChild(getElement('menu-overlay'));
      }
      var ele = createElement('div');
      body.appendChild(ele);
      ele.className = 'menu-overlay';
      ele.setAttribute('id', 'menu-overlay');
      ele.addEventListener('click', function(eve) {
        if (eve.pageX > getElement('menu-overlay').offsetWidth / 2) {
          editor.closeMenu();
        }
      }, true);
      var elep = createElement('div');
      elep.className = 'menu';
      ele.appendChild(elep);
      //add the close button
      ele = createElement('button');
      ele.appendChild(createTextNode('close'));
      ele.style.fontWeight = 'bold';
      ele.style.color = '#fff';
      ele.style.background = '#c00';
      ele.className = 'closer';
      ele.style.cssFloat = 'right';
      ele.setAttribute('onclick','editor.closeMenu();');
      elep.appendChild(ele);
      elep.appendChild(createElement('br'));
      elep.appendChild(createElement('br'));
      elep.appendChild(createElement('hr'));
      //add dependencies, new game, play
      ele = createElement('button');
      ele.className = 'input';
      ele.appendChild(createTextNode('set dependencies'));
      ele.setAttribute('onclick','editor.showDependenciesPrompt(\'\');editor.closeMenu();');
      elep.appendChild(ele);
      elep.appendChild(createElement('br'));
      //place those buttons in the editor menu !
      ele = createElement('button');
      ele.className = 'input';
      ele.appendChild(createTextNode('new game'));
      ele.setAttribute('onclick','editor.newGame();editor.closeMenu();');
      elep.appendChild(ele);
      elep.appendChild(createElement('br'));
      ele = createElement('button');
      ele.className = 'input';
      //ele.setAttribute('id','playbutton');
      ele.appendChild(createTextNode('play'));
      ele.setAttribute('onclick','editor.showPrompt(\'Here you can play and test you game.\',\'editor.playGame(\',null);editor.closeMenu();');
      elep.appendChild(ele);
      elep.appendChild(createElement('br'));
      //add a save game button
      //add a load game button
      //add a new level button
      //a logo?
      ele = createElement('div');
      ele.style.width = ele.style.maxWidth = (elep.offsetWidth*0.8)+'px';
      ele.style.maxHeight = ele.style.height = (elep.offsetWidth*0.8)+'px';
      ele.className = 'epicon';
      //ele.style.marginLeft = '9.5%';
      ele.style.position = 'fixed';
      ele.style.bottom = '0';
      ele.style.right = '-'+(elep.offsetWidth*0.1)+'px';
      elep.appendChild(ele);
    };
    /**

    */
    editor.closeMenu = function() {
      getElement('menu-overlay').style.display='none';
      if (getElement('menu-overlay') != null) {
        body.removeChild(getElement('menu-overlay'));
      }
    };
    /**
    replacement for setOrder and setEvents
    sets the order for the specified object by id
    and updates the appearence of the editor's output
    setting the code for the event
    events are code, but !NOT action model structs [(action name),(value)]!
    @method setOrderAndEvents
    */
    editor.setOrderAndEvents = function(obj_id) {
      var obj=game.getObject(obj_id);
      var input = getElement('input_ord_'+obj_id).value;
      try
      {
        input = parseInt(input);
      }
      catch (ex)
      {
        editor.showAlert('Choose a valid value, please!')
        return;
      }
      if (input < 0 || input > game.objects.length) {
        editor.showAlert('Choose a valid value, please!');
        return;
      }
      obj.order = input;
      //setting the output order element (bottom left orange box)
      var ele = getElement('ord_'+obj.id);
      ele.innerHTML = '';
      ele.appendChild(createTextNode(obj.order));
      //
      var i = 0;
      var action = null;
      //gathering all event selects and inputs
      //this is a simple numeric order
      while (getElement('select_eve_method_'+i) != null) {
        action = getElement('select_eve_method_'+i).value;
        obj.events[i].method = action;
        obj.events[i].values = [(action == 'showText' ?
          btoa(getElement('input_eve_values_'+i).value) : getElement('input_eve_values_'+i).value)];
        i++;
        //one after an other
      }
      //setting the new object grid content
      ele = getElement(''+obj_id);
      ele.innerHTML = '';
      ele.appendChild(createTextNode(obj_id));
      ele.appendChild(createElement('br'));
      ele.appendChild(createTextNode(obj.order));

      console.log(input,obj.order,obj.events);
      editor.saveGame();
      getElement('prompt').style.display = 'none';
    }
    /**
    @method showTextMenu
    @param id id of the object
    @param menuEntries array menu's texts and methods
    */
    editor.showTextMenu = function(id, menuEntries) {
      editor.setCurrent(id);
      console.log(id,menuEntries);
      var obj = game.getObject(id);
      editor.setText(id, obj.getText());
      var prompt = editor.createPrompt();
      prompt.appendChild(createElement('hr'));

      for (var i = 0; i < menuEntries.length; i++) {
        ele = createElement('div');
        prompt.appendChild(ele);
        ele.appendChild(createTextNode(menuEntries[i].txt));
        ele.setAttribute('onclick',menuEntries[i].method);
        prompt.appendChild(createElement('hr'));
      }
      prompt.style.display = 'block';
    };
    /**
    calls setText,
    stores the game if store is available.
    @method setStart
    @param obj_id id of the object
    */
    editor.setStart = function(obj_id) {
      editor.mode='setstart';
      editor.setText(obj_id,null);
      getElement('prompt').style.display = 'none';
      editor.saveGame();
    }
    /**
    calls setText,
    stores the game if store is available.
    @method setStop
    @param obj_id id of the object
    */
    editor.setStop = function(obj_id) {
      editor.mode='setend';
      editor.setText(obj_id,null);
      getElement('prompt').style.display = 'none';
      editor.saveGame();
    }
    /**
    this method makes much more as the name tells you.
    it is used to set the start & stop tile finally.
    If not, it will  prompt for a text for the specified object
    and set the text and it updates the output.
    stores the game if store is available.
    @method setText
    @param id id of the object
    @param text the text for the object
    */
    editor.setText = function(_id,_text){
      var obj=game.getObject(_id);
      if (editor.mode=='setstart') {
        if (getElement('s_'+game.start)!=null) {
          getElement('s_'+game.start).style.color = '#006';
          getElement(game.start).className = 'grid-ready';
        } else if (game.start!=null) {
          getElement(game.start).className = 'grid-element';
        }
        game.start = _id;
        obj.active = true;
        obj.visible = true;
        if (game.start == game.end) {
          game.end=null;
        }
        getElement(_id).className = 'grid-start';
        if (getElement('s_'+_id)!=null) {
          getElement('s_'+_id).style.color = '#0c0';
        }
        editor.mode = '';
        return;
      }
      if (editor.mode=='setend') {
        if (getElement('s_'+game.end)!=null) {
          getElement('s_'+game.end).style.color = '#006';
          getElement(game.end).className = 'grid-ready';
        } else if (game.end!=null) {
          getElement(game.end).className = 'grid-element';
        }
        game.end = _id;
        if (game.start == game.end) {
          game.start=null;
        }
        getElement(_id).className = 'grid-end';
        if (getElement('s_'+_id)!=null) {
          getElement('s_'+_id).style.color = '#c00';
        }
        editor.mode = '';
        return;
      }
      if (_text==null) {
        if (obj.text==null) {
          _text = editor.showPrompt('What\'s up next?','', 'editor.setText(\''+obj.id+'\',');
        } else {
          _text = editor.showPrompt('What\'s up next?',obj.getText(), 'editor.setText(\''+obj.id+'\',');
        }
        return;
      }
      obj.setText(_text);
      if (game.start == null)
      {
        game.start =_id;
        getElement(_id).className='grid-start';
      } //else {

      if (_id != game.start && _id != game.end) {
        getElement(_id).className='grid-ready';
      } else if (_id == game.start) {
        getElement(_id).className='grid-start';
      } else if (_id == game.end)
      {
        getElement(_id).className='grid-end';
      }

      //}
      var ele = getElement('output');
      ele.innerHTML = '';
      var ele2 = getElement('s_'+obj.id);
      if (ele2 == null) {
        ele2 = createElement('span');
        ele2.style.display='inline-block';
        //ele2.style.border='dotted 1px #999';
        ele2.style.minWidth = '98%';
        ele2.style.background = '#f90';
        ele2.style.marginTop = '2%';
        ele2.setAttribute('id','s_'+obj.id);
        var span = createElement('span');
        span.className = 'input';
        span.style.cssFloat='left';
        span.style.minWidth='12.5%';
        span.style.maxWidth='12.5%';
        span.setAttribute('id','ord_'+obj.id);
        span.setAttribute('onclick','editor.showOrderAndEventsPrompt(\''+obj.id+'\');');
        span.appendChild(createTextNode(obj.order));
        ele2.appendChild(span);
        span = createElement('div');
        span.className = 'input';
        span.style.cssFloat='left';
        span.style.minWidth='78%';
        span.style.maxWidth='78%';
        span.setAttribute('id','s_t_'+obj.id);
        span.setAttribute('onclick', 'editor.setText(\''+obj.id+'\',null);');
        span.appendChild(createTextNode(_text));
        ele2.appendChild(span);
        ele.appendChild(ele2);
        ele.appendChild(createElement('br'));
      } else {
        /*ele2 = getElement('s_t_'+obj.id);
        ele2.innerHTML = '';
        ele2.appendChild(createTextNode(_text));
        ele2 = getElement('ord_'+obj.id);
        ele2.innerHTML = '';
        ele2.appendChild(createTextNode(obj.order));*/
      }
      if (_id == game.start) {
        ele2.style.color = '#0c0';
      } else {
        if (_id == game.end) {
          ele2.style.color = '#c00';
        } else {
          ele2.style.color = '#006';
        }
      }
      editor.saveGame();
    };
    /**
    @method saveGame
    */
    editor.saveGame = function() {
      try {
        store.setItem('gridStoryGame',JSON.stringify(game));
      } catch (ex) {
        console.log(ex);
      }
    };
    /**
    @method setQuest
    */
    editor.setQuest = function(text) {
      if (text == null || text == '') {
        editor.showPrompt('Enter the quest of the game.', game.quest==null?'':atob(game.quest), 'editor.setQuest(');
        return;
      }
      game.quest = btoa(text);
      //getElement('quest').innerHTML = atob(game.quest);
      getElement('quest').value = atob(game.quest);
      editor.saveGame();
    };
    /**
    @method setTitle
    */
    editor.setTitle = function(text) {
      if (text == null || text == '') {
        editor.showPrompt('Enter the game\'s title.', game.title==null?'':atob(game.title), 'editor.setTitle(');
        return;
      }
      game.title = btoa(text);
      //getElement('title').innerHTML = atob(game.title);
      getElement('title').value = atob(game.title);
      editor.saveGame();
    };
    /**
    @method showPrompt()
    @param txt
    @param value
    @param callback
    */
    editor.showPrompt = function(txt, value, callback) {
      var prompt = editor.createPrompt();
      prompt.appendChild(createTextNode(txt));
      var ele = createElement('input');
      if (callback == null) {
        callback = value;
        value = null;
      } else {
        if (value == 'null' || value == null) value = '';
        ele.className = 'input';
        ele.value = value;
        ele.setAttribute('id','prompt-input');
        prompt.appendChild(ele);
        prompt.appendChild(createElement('br'));
      }
      prompt.appendChild(createElement('br'));
      ele = createElement('button');
      if (value === null) {
        if (callback == null) {
          ele.setAttribute('onclick','getElement(\'prompt\').style.display = \'none\';');
        } else {
          ele.setAttribute('onclick',callback+');getElement(\'prompt\').style.display = \'none\';');
        }
      } else {
        ele.setAttribute('onclick',callback+'getElement(\'prompt-input\').value);getElement(\'prompt\').style.display = \'none\';');
      }
      ele.appendChild(createTextNode('done'));
      prompt.appendChild(ele);
      prompt.appendChild(createElement('br'));
      prompt.style.display = 'block';
    };
    /**
    */
    editor.createPrompt = function() {
      var prompt = getElement('prompt');
      if (prompt == null)
      {
        prompt = createElement('div');
        prompt.className = 'prompt';
        prompt.setAttribute('id','prompt');
        body.appendChild(prompt);
      }
      prompt.innerHTML = '';
      var ele = createElement('button');
      ele.className='closer';
      ele.style.fontWeight = 'bold';
      ele.style.color = '#fff';
      ele.style.background = '#c00';
      ele.setAttribute('onclick','getElement(\'prompt\').style.display=\'none\';');
      ele.appendChild(createTextNode('close'));
      prompt.appendChild(ele);
      prompt.appendChild(createElement('br'));
      return prompt;
    }
    /**
    a test and play method
    @method playGame
    */
    editor.playGame = function() {
      /*editor.saveGame();
      editor.oldGame = game;
      //new game instance
      game = editor.loadGame();
      win.canvas = getElement('canvas');
      if (canvas == null) {
        canvas = createElement('canvas');
      } else {
        //body.removeChild(canvas);
        //body.appendChild(canvas);
        ctx = canvas.getContext('2d');
      }
      var w = window.innerWidth;
      var h = window.innerHeight;
      //test
      w > 410 ? w = 410: w = w;
      //replace this once if everything will be canvas based including the editor
      canvas.width = w < h ? w : h;
      canvas.height = w < h ? w : h;
      canvas.style.width = canvas.width+'px';
      canvas.style.height = canvas.height+'px';
      win.ctx = canvas.getContext('2d');
      canvas.style.position='absolute';
      canvas.style.left=0;
      canvas.style.top=0;
      canvas.style.background='rgba(255,255,255,0.75)';
      getElement('playbutton').innerHTML='';
      getElement('playbutton').appendChild(createTextNode('stop'));
      getElement('playbutton').setAttribute('onclick' , 'editor.stopGame();');
      body.appendChild(canvas);
      game.init();*/
      editor.saveGame();
      editor.oldGame = game;

      canvas = getElement('canvas');
      var canvascontainer = createElement('div');
      if (canvas != null) {
        body.removeChild(canvascontainer);
      }
	    var canvascontainer = createElement('div');
      canvas = createElement('canvas');
      var w = window.innerWidth;
      var h = window.innerHeight;
      //test
      w > 420 ? w = 420: w = w;
      //h > 560 ? h = 560: h = h;
      //replace this once if everything will be canvas based including the editor
      canvas.width = w;//w < h ? w : h;
      canvas.height = h;//w < h ? w : h;
      canvas.style.width = canvas.width+'px';
      canvas.style.height = canvas.height+'px';
      //win.ctx = canvas.getContext('2d');
      //canvas.style.position='absolute';
      canvas.style.left=0;
      canvas.style.top=0;
      canvas.style.background='rgba(255,255,255,0.75)';
      //canvas.style.position='absolute';
      canvas.style.top = '0';
      canvas.style.left = '0';
      bufferImg = createElement('canvas');
      bufferImg.width = canvas.width;//400|800|1200|1600|2000|2400
      bufferImg.height = canvas.width;//225|450|675|900|1125|1350
      btx = bufferImg.getContext('2d');
      //add the touch and mouselisteners to the canvas now.
      if ('ontouchstart' in window) {
        console.log('using touch');
        canvas.addEventListener('touchstart',
        function(eve) {
          eve.preventDefault();
          mousePressed(eve.touches[0].pageX,eve.touches[0].pageY);
        },
        false);
        canvas.addEventListener('touchmove',
        function(eve) {
          eve.preventDefault();
          mx = eve.touches[0].pageX;
          my = eve.touches[0].pageY;
          mouseMoved(mx,my);
        },
        false);
        canvas.addEventListener('touchend',
        function(eve) {
          eve.preventDefault();
          //if (!mend) {
            mend = true;
            mouseReleased(mx, my);
          //}
        },
        false);
        canvas.addEventListener('touchcancel',
        function(eve) {
          eve.preventDefault();
          //if (!mend) {
            mend = true;
            mouseReleased(mx, my);
          //}
        },
        false);
      } //else {
      canvas.addEventListener('mousedown',
      function(eve) {
        mousePressed(eve.pageX,eve.pageY);
      },
      false);
      canvas.addEventListener('mousemove',
      function(eve) {
        mx = eve.pageX;
        my = eve.pageY;
        mouseMoved(mx,my);
      },
      false);
      canvas.addEventListener('mouseup',
      function(eve) {
        mouseReleased(eve.pageX,eve.pageY);
      },
      false);

      getElement('playbutton').innerHTML='';
      getElement('playbutton').appendChild(createTextNode('stop'));
      getElement('playbutton').setAttribute('onclick' , 'editor.stopGame();');
      canvascontainer.className = 'canvas-container';
      canvascontainer.appendChild(canvas);
      body.appendChild(canvascontainer);
      canvascontainer.style.display = 'block';
      canvascontainer.setAttribute('id', 'canvascontainer');
      ctx = canvas.getContext('2d');
      //new game instance
      game.init();
      gmode = 'game';
      update = true;
    };
    /**
    stop the play test
    @method stopGame
    */
    editor.stopGame = function() {
      //restore the old game instance
      game = editor.oldGame;
      editor.oldGame = null;
      canvas.style.display = 'none';
      body.removeChild(getElement('canvascontainer'));
      getElement('playbutton').innerHTML='';
      getElement('playbutton').appendChild(createTextNode('play'));
      getElement('playbutton').setAttribute('onclick' , 'editor.playGame();');
    };
    /**
    @method newGame
    */
    editor.newGame = function() {
      var value = confirm('Do you realy want to delete the game?');
      console.log(value);
      if (value!=true)
      {
        return;
      }
      game = new Game();
      game.objects = [];
      game.start = null;
      game.end = null;
      game.quest = null;
      game.title = null;
      game.order = [];
      for (var i = 0; i < 4; i++)
      {
        for (var j = 0; j < 4; j++)
        {
          ele = getElement('o_'+i+'_'+j);
          ele.className = 'grid-element';
          game.objects.push(new GameObject(ele.id, null) );
        }
      }
      getElement('output').innerHTML = '';
      editor.saveGame();
    };
    /**
    the method might provide an empty game,
    if the store is not enabled
    @method loadGame
    @return an initialized instance of game
    */
    editor.loadGame = function() {
      var g = new Game();
      var data = null;
      try {
        data = JSON.parse(store.getItem('gridStoryGame'));
      } catch(ex) {
        console.log(ex);
      }
        g.objects = [];
        var obj = null;
        if (data != null)
        for (var i = 0; i < data['objects'].length; i++)
        {
          obj = new GameObject();
          obj.load(data['objects'][i]);
          g.objects.push(obj);
        }
        g.dependencies = [];
        if (data != null)
        if (data['dependencies']!= null) {
          for (var i = 0; i < data['dependencies'].length; i++) {
            var d = new GameDependency();
            d.load(data['dependencies'][i]);
            g.dependencies.push(d);
          }
        }
        g.order = [];
        if (data != null) {
          g.start = data['start'];
          g.end = data['end'];
          g.quest = data['quest'];
          g.title = data['title'];
        } else {
          g.start = null;
          g.end = null;
          g.quest = null;
          g.title = null;
        }
      /*}
      catch (ex) {
        console.log(ex);
      }*/
      return g;
    };
    /**
    @method setCurrent
    */
    editor.setCurrent = function(id) {
      var ele = null;
      if (editor.current != null) {
        ele = getElement('p'+editor.current);
        ele.className = ele.className.replace(/ current/g, '');
        //ele.setAttribute('onclick','editor.setText(\''+ele.id+'\',null);');
      }
      editor.current = id;
      ele = getElement('p'+id);
      ele.className = ele.className+' current';
      //ele.setAttribute('onclick','editor.setOrderAndEvents(\''+ele.id+'\');');
    };
    /**
    @method showOrderAndEventsPrompt
    */
    editor.showOrderAndEventsPrompt = function(obj_id) {
      var obj = game.getObject(obj_id);
      var prompt = editor.createPrompt();
      prompt.appendChild(createTextNode('order'));
      //prompt.appendChild(createElement('br'));
      var span = createElement('input');
      span.className = 'input';
      span.style.marginRight='1px';
      span.style.minWidth='12.5%';
      span.setAttribute('id','input_ord_'+obj.id);
      span.value = obj.order;
      prompt.appendChild(span);
      //prompt.appendChild(createElement('br'));
      span = createElement('span');
      span.className = 'helptext';
      span.appendChild(createTextNode('event: showObject([object id]), hideObject([object id]), showText([a text])'));
      prompt.appendChild(span);
      //prompt.appendChild(createElement('br'));
      span = createElement('button');
      span.appendChild(createTextNode('add event'));
      span.setAttribute('onclick', 'editor.addEvent(\''+obj.id+'\');');
      prompt.appendChild(span);
      span = createElement('div');
      span.style.marginRight='1px';
      span.style.display='inline-block';
      span.style.minWidth='90%';
      span.style.maxWidth='90%';
      span.style.border = 'solid 1px #999';
      span.setAttribute('id','div_events');
      prompt.appendChild(span);
      var methods = ['showText','showObject','hideObject'];
      //console.log(''+obj.events.length);
      for (var i = 0; i < obj.events.length; i++) {
        var ele = createElement('select');
        ele.setAttribute('id', 'select_eve_method_'+i);
        ele.style.cssFloat='left';
        for (var j = 0; j < methods.length; j++) {
          var opt = createElement('option');
          opt.value = methods[j];
          opt.appendChild(createTextNode(methods[j]));
          ele.appendChild(opt);
        }
        //ele.style.width='48%';
        ele.value = obj.events[i].method;
        span.appendChild(ele);
        ele = createElement('input');
        ele.setAttribute('id', 'input_eve_values_'+i);
        ele.style.cssFloat='left';
        ele.style.minWidth = ele.style.width = obj.events[i].method=='showText' ? '98%':'48%';
        try {
          ele.value = obj.events[i].method=='showText' ?  atob(obj.events[i].values) : obj.events[i].values;
        } catch (ex) {
          ele.value = obj.events[i].values
        }
        span.appendChild(ele);
        ele = createElement('br');
        ele.style.clear = 'both';
        span.appendChild(ele);
        span.appendChild(createElement('hr'));
      }
      prompt.appendChild(createElement('br'));
      prompt.appendChild(createElement('hr'));
      span = createElement('button');
      span.appendChild(createTextNode('set order and events'));
      span.setAttribute('onclick','editor.setOrderAndEvents(\''+obj.id+'\');');
      prompt.appendChild(span);
      prompt.appendChild(createElement('br'));
      prompt.style.display='block';
    };
    /**
    @method addEvent
    */
    editor.addEvent = function(obj_id) {
      var obj = game.getObject(obj_id);
      //the current object
      //the prompt scoll element-div
      var ele = getElement('div_events');
      //add a new event div
      var span = createElement('select');
      span.setAttribute('id', 'select_eve_method_'+obj.events.length);
      span.style.cssFloat='left';
      var methods = ['showText','showObject','hideObject'];
      for (var j = 0; j < methods.length; j++) {
        var opt = createElement('option');
        opt.value = methods[j];
        opt.appendChild(createTextNode(methods[j]));
        span.appendChild(opt);
      }
      span.style.width='48%';
      span.setAttribute('placeholder','method');
      ele.appendChild(span);
      span = createElement('input');
      span.setAttribute('id', 'input_eve_values_'+obj.events.length);
      span.style.cssFloat='left';
      span.style.width='48%';
      span.setAttribute('placeholder','value');
      ele.appendChild(span);
      ele.appendChild(createElement('hr'));
      obj.events.push(new GameEvent());
    };
    /**
    @method showDependenciesPrompt
    */
    editor.showDependenciesPrompt = function(obj_id) {
      var prompt = editor.createPrompt();
      var span = createElement('span');
      span.className = 'helptext';
      span.appendChild(createTextNode('dependencies: isSmaller, hasMissed'));
      span.appendChild(createElement('br'));
      span.appendChild(createTextNode('{priority: 0, method:\'isSmaller\', text: \'show this text\', params: [a,b]}'));
      span.appendChild(createElement('br'));
      span.appendChild(createTextNode('{priority: 1, method:\'hasMissed\', text: \'show this text because of the higher priority\', params: [a]}'));
      prompt.appendChild(span);
      ele = createElement('div');
      var dependencies = game.dependencies;
      //console.log(dependencies.length);
      for (var i = 0; i < dependencies.length; i++) {
        ele.appendChild(createTextNode('priority: '));
        span = createElement('input');
        //span.style.cssFloat='left';
        //console.log(dependencies[i]);
        span.style.marginRight='1px';
        span.style.display='inline-block';
        span.style.minWidth='10%';
        span.style.maxWidth='10%';
        span.style.border = 'solid 1px #999';
        span.setAttribute('id','depend_priority_'+i);
        span.value = dependencies[i].priority;
        ele.appendChild(span);
        ele.appendChild(createElement('br'));
        ele.appendChild(createTextNode(' method: '));
        span = createElement('input');
        span.setAttribute('type', 'radio');
        span.style.marginRight='1px';
        span.style.display='inline-block';
        span.style.border = 'solid 1px #999';
        span.setAttribute('id','depend_smaller_'+i);
        dependencies[i].method=='isSmaller'? span.checked=true : span.value='';
        ele.appendChild(span);
        ele.appendChild(createTextNode(' isSmaller '));
        span = createElement('input');
        span.setAttribute('type', 'radio');
        span.style.marginRight='1px';
        span.style.display='inline-block';
        span.style.border = 'solid 1px #999';
        span.setAttribute('id','depend_missed_'+i);
        dependencies[i].method=='hasMissed' ? span.checked=true : span.value='';
        ele.appendChild(span);
        ele.appendChild(createTextNode(' hasMissed'));
        //need a unselect button here for no issmaller and no hasmissed
        ele.appendChild(createElement('br'));
        ele.appendChild(createTextNode('text: '));
        span = createElement('input');
        //span.style.cssFloat='left';
        span.style.marginRight='1px';
        span.style.display='inline-block';
        span.style.minWidth='70%';
        span.style.maxWidth='70%';
        span.style.border = 'solid 1px #999';
        span.setAttribute('id','depend_text_'+i);
        span.value = atob(dependencies[i].text);
        ele.appendChild(span);
        ele.appendChild(createElement('br'));
        ele.appendChild(createTextNode('params: '));
        var dmax = dependencies[i].method == 'hasMissed' ? 1 : 2;
        for (var j = 0; j < dmax; j++) {
          span = createElement('select');
          span.style.marginRight='1px';
          span.style.display='inline-block';
          span.style.minWidth='40%';
          span.style.maxWidth='40%';
          span.style.border = 'solid 1px #999';
          span.setAttribute('id','depend_params_'+i+'_'+j);
          var option = null;
          //set the selected value and avoid the selected object
          for (var k = 0; k < game.objects.length; k++)
          {
            option = createElement('option');
            option.value = game.objects[k].id;
            option.appendChild(createTextNode(game.objects[k].id));
            span.appendChild(option);
            if (dependencies[i].method == 'hasMissed' && dependencies[i].params[0] == game.objects[k].id) {
              option.setAttribute('selected', 'true');
            }
          }
          ele.appendChild(span);
        }
        ele.appendChild(createElement('hr'));
      }
      //console.log('hello');
      ele.setAttribute('id','dependencies');
      prompt.appendChild(ele);
      span = createElement('button');
      span.appendChild(createTextNode('add dependency'));
      span.setAttribute('onclick','editor.addDependency();');
      prompt.appendChild(span);
      prompt.appendChild(createElement('br'));
      prompt.appendChild(createElement('hr'));
      span = createElement('button');
      span.appendChild(createTextNode('set dependencies'));
      span.setAttribute('onclick','editor.setDependencies();');//\''+obj_id+'\');');
      prompt.appendChild(span);
      prompt.appendChild(createElement('br'));
      prompt.style.display='block';
    };
    /**
    adds a single empty denpency to the element dependencies and the array
    @method addDependency
    */
    editor.addDependency = function() { //obj_id) {
      var dependencies = game.dependencies;
      var ele = getElement('dependencies');
      ele.appendChild(createTextNode('priority: '));
      span = createElement('input');
      //span.style.cssFloat='left';
      span.style.marginRight='1px';
      span.style.display='inline-block';
      span.style.minWidth='10%';
      span.style.maxWidth='10%';
      span.style.border = 'solid 1px #999';
      span.setAttribute('id','depend_priority_'+dependencies.length);
      span.value = '';
      ele.appendChild(span);
      ele.appendChild(createElement('br'));
      ele.appendChild(createTextNode(' method: '));
      span = createElement('input');
        span.setAttribute('type', 'radio');
        span.style.marginRight='1px';
        span.style.display='inline-block';
        span.style.border = 'solid 1px #999';
        span.setAttribute('id','depend_smaller_'+dependencies.length);
        //dependencies[i].method == 'isSmaller' ? span.checked=true : span.value='';
        ele.appendChild(span);
        ele.appendChild(createTextNode(' isSmaller '));
        span = createElement('input');
        span.setAttribute('type', 'radio');
        span.style.marginRight='1px';
        span.style.display='inline-block';
        span.style.border = 'solid 1px #999';
        span.setAttribute('id','depend_missed_'+dependencies.length);
        //dependencies[i].method == 'hasMissed' ? span.checked=true : span.value='';
        ele.appendChild(span);
        ele.appendChild(createTextNode(' hasMissed'));
      ele.appendChild(createElement('br'));
      ele.appendChild(createTextNode('text: '));
      span = createElement('input');
      //span.style.cssFloat='left';
      span.style.marginRight='1px';
      span.style.display='inline-block';
      span.style.minWidth='70%';
      span.style.maxWidth='70%';
      span.style.border = 'solid 1px #999';
      span.setAttribute('id','depend_text_'+dependencies.length);
      span.value = '';
      ele.appendChild(span);
      ele.appendChild(createElement('br'));
      ele.appendChild(createTextNode('params: '));
      for (var j = 0; j < 2; j++) {
        span = createElement('select');
        //span.style.cssFloat='left';
        span.style.marginRight='1px';
        span.style.display='inline-block';
        span.style.minWidth='40%';
        span.style.maxWidth='40%';
        span.style.border = 'solid 1px #999';
        span.setAttribute('id','depend_params_'+dependencies.length+'_'+j);
        span.setAttribute('name','depend_params_'+dependencies.length+'_'+j);
        var option = null;
        //
        for (var k = 0; k < game.objects.length; k++)
        {
          option = createElement('option');
          option.value = game.objects[k].id;
          option.appendChild(createTextNode(game.objects[k].id));
          span.appendChild(option);
        }
        ele.appendChild(span);
      }
      ele.appendChild(createElement('hr'));
      dependencies.push({priority:'',method:'',text:'',params:[]});
      //var d = new GameDependency(0,null,[]);
      //dependencies.push(d);
    };
    /**
    read the input values of the dendencies element and sets the values in the dependencies array
    is saving the game
    @method setDependencies
    */
    editor.setDependencies = function() {
      var dependencies = game.dependencies;
      //set the selected value and avoid the selected object
      for (var i = 0; i < dependencies.length; i++)
      {
        //
        var input = getElement('depend_priority_'+i).value;
        dependencies[i].priority = input;
        input = getElement('depend_text_'+i).value;
        dependencies[i].text = btoa(input);
        //it's a radio button!
        input = getElement('depend_missed_'+i).checked ? 'hasMissed' : 'isSmaller';
        console.log(input);
        dependencies[i].method = input;
        dependencies[i].params = [];
        var j = 0;
        var ele = getElement('depend_params_'+i+'_'+j);
        while (ele != null && j < game.objects.length)
        {
          console.log(ele);
          dependencies[i].params.push(ele.value);
          j++;
          ele = getElement('depend_params_'+i+'_'+j);
        }
      }
      editor.saveGame();
      console.log(game.dependencies);
      getElement('prompt').style.display = 'none';
    };
    /* *
    @method setEvent
    * /
    editor.setEvent = function(id) {
      var obj = game.getObject(id);
      var code = prompt('add some event code: showObject, hideObject, showText', obj.event==null?'':atob(obj.event) );
      //editor.showPrompt(obj);
      if (code != '')
      {
        obj.setEvent(code);
        //editor.setDependecies(obj);
        editor.saveGame();
      }
    };*/
    /**
    an general method
    @method updateDraw
    */
    var updateDraw = function() {
      if (update) {
        if (gmode == 'editor') {
          //editor.draw();
        } else {
          game.draw();
        }
        update = false;
      }
      requestAnimationFrame(function() { updateDraw(); } );
    };
    /**
    an editor method
    @method draw
    */
    editor.draw = function() {
      /*
      var cw = canvas.width;
      var ch = canvas.height;
      //ctx.fillStyle = '#eee';
      //ctx.fillRect(0,0,cw,ch);
      ctx.fillStyle = '#000';
      var fts = Math.round(0.035*cw);
      ctx.font = fts+'px Sans-Serif';
      var objects = game.objects;
      var obj = null;
      {//game or editor
        //ctx.fillText(''+atob(game.title),0.02*cw,0.01*cw+fts);
        //ctx.fillText(''+atob(game.quest),0.02*cw,(0.01*cw+fts)*2);
        //begin of btx context
        ctx.lineWidth = 0.025 * cw;
        //editor.showAlert('objects.length='+objects.length);
        for (var i = 0; i < objects.length; i++)
        {
          obj = objects[i];
          //if (obj.visible) {
            if (obj.id == game.start)
            {
              ctx.fillStyle = '#0c0';
              ctx.strokeStyle = '#000';
            } else if (obj.id == game.end)
            {
              if (obj.active)
              {
                ctx.fillStyle = '#c00';
                ctx.strokeStyle = '#000';
              } else {
                ctx.fillStyle = 'rgba(204,51,51,0.5)';
                ctx.strokeStyle = 'rgba(51,51,51,0.5)';
              }
            } else if (obj.active)
            {
              ctx.fillStyle = '#99c';
              ctx.strokeStyle = '#000';
            } else {
              ctx.fillStyle = 'rgba(128,128,128,0.5)';
              ctx.strokeStyle = 'rgba(51,51,51,0.5)';
            }
            if (game.current != null && obj.id == game.current.id) {
              ctx.strokeStyle = '#f90';
            }
            ctx.fillRect(obj.x * cw, obj.y * cw, obj.w * cw, obj.h * cw);
            ctx.strokeRect(obj.x * cw, obj.y * cw, obj.w * cw, obj.h * cw);
          //}
        }*/
        //end of btx context
        /*ctx.fillStyle = '#000';
        var fts = Math.round(0.035*cw);
        ctx.font = fts+'px Sans-Serif';
        ctx.fillText(''+atob(game.title),0.02*cw,0.01*cw+fts);
        ctx.fillText(''+atob(game.quest),0.02*cw,(0.01*cw+fts)*2);
        if (game.current != null) {
          ctx.fillText(''+game.current.getText(),0.02*cw,(0.01*cw+fts)*3);
        } else if (game.order.length > 0) {
          var j = 0;
          for (var i = game.order.length - 1; i >= (game.order.length > 2 ? game.order.length-3 : 0); i--) {
            ctx.fillText(''+game.getObject(game.order[i]).getText(),0.02*cw,
                    (0.01*cw+fts)*((game.order.length > 2 ? 3 : game.order.length)+(2-j)));
            j++;
          }
          if (game.currentText!= null) {
            ctx.fillText(''+game.currentText,0.02*cw,(0.01*cw+fts)*6.25);
          }
        }*/
      //}//draw menu, inputs, prompts and selects here
    };
    /**
    */
    editor.createUid = function() {
      var abc = 'abcdefghijklmnopqrstuvwxyz1234567890ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      var uid = '';
      while (uid.length < editor.uidMax || editor.hasUid(uid)) {
         uid = '';
         for (var i = 0; i < editor.uidMax; i++)
         {
           uid = uid + abc.substr(Math.floor(Math.random()*abc.length), 1);
         }
         if (!isNaN(uid))
         {
           uid = '_'+uid;
         }
      }
      editor.addUid(uid);
      return uid;
    };
    /**
    @method mousePressed
    */
    var mousePressed = function(x,y) {
      if (gmode == 'editor') {
        //editor.mousePressed(x,y);
      } else {
        game.mousePressed(x,y);
      }
    };
    /**
    @method mouseMoved
    */
    var mouseMoved = function(x,y) {
      if (gmode == 'editor') {
        //editor.mouseMoved(x,y);
      } else {
        game.mouseMoved(x,y);
      }
    };
    /**
    @method mouseReleased
    */
    var mouseReleased = function(x,y) {
      if (gmode == 'editor') {
        //editor.mouseReleased(x,y);
      } else {
        game.mouseReleased(x,y);
      }
    };
    /**
    */
    var menuicon = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAABmklEQVRoQ+2YIUtFQRCFv1d82SAWEfwBCnaDSTAIgtEgaDKpzWizajGqr7z0QDBpNJgF/QFiEAwiiD9AGXjhIlx3Z/cO9zrsq2/mzJw5u2eW28PJr+eEB4VI15QsihRFjCagOVpbRj2EYAehAPk/hsgs8BIDZhizADz9hR8isgZcGzaogd4EhnUJISJXwLqmmmHsDbCaSuTbsLEU6NrBhxRxQ0Sc6jJldAY5+8Bp6tGSvDNg16AxDeQ5sJPjWtXcZ03lBmPnYrBCdyQGoxMxhUgnZKg0URT5j4pMjO33pKXmZX+I/X7l2O8k8NESgd9lp4D31IXoZrO7eWu5IeLmaE0Dbx257DPAa+pll7w+cAgctURI6or1f+bYb0u968uWJ4p+ZrYZRRHb+erRNYo86OEbyViMQYkhcjy23xg8qxix34Mc+3Wz2d28tdwQuQVWrA6+EvcOWE59a20AI2VBq/Bt4CKViOTNA49W3UXiLgH3Oa5Vzd2LLNp0WO2H62qhmD3SdGMmeIWIyVgzQIsiGcMzSS2KmIw1A/QHntksM/+ir4IAAAAASUVORK5CYII=';
    /**
    editor method
    @method init
    */
    editor.init = function() {
      //game = new Game();
      game = editor.loadGame();
      var ele = null;
      ele = createElement('button');
      ele.style.backgroundImage = 'url('+menuicon+')';
      ele.style.backgroundSize = '100%';
      ele.style.width = '12.5%';
      body.appendChild(ele);
      ele.style.height = ele.offsetWidth+'px';
      ele.style.margin = '1%';
      ele.style.cssFloat = 'left';
      ele.setAttribute('onclick','editor.showMenu();');
      //***************************//
      ele = createElement('input');
      ele.className = 'input';
      ele.style.minWidth = ele.style.maxWidth = '80%';
      //ele.style.cssFloat = 'right';
      ele.setAttribute('onclick','editor.setTitle();');
      ele.setAttribute('id','title');
      //ele.appendChild(createTextNode(game.title==null?'click to edit title.':atob(game.title)));
      ele.value = (game.title==null?'click to edit title.':atob(game.title));
      body.appendChild(ele);
      //ele = createElement('br');
      //ele.style.clear='both';
      //body.appendChild(ele);
      //ele = createElement('span');
      ele = createElement('input');
      ele.className = 'input';
      ele.style.minWidth = ele.style.maxWidth = '80%';
      //ele.style.cssFloat = 'right';
      ele.setAttribute('onclick','editor.setQuest();');
      ele.setAttribute('id','quest');
      //ele.appendChild(createTextNode(game.quest==null?'click and enter quest.':atob(game.quest)));
      ele.value = (game.quest==null?'click and enter quest.':atob(game.quest));
      body.appendChild(ele);
      ele = createElement('br');
      ele.style.clear='both';
      body.appendChild(ele);
      win.canvas = getElement('canvas');
      if (canvas == null) {
        canvas = createElement('canvas');
      } else {
        body.removeChild(canvas);
      }
      var w = window.innerWidth;
      var h = window.innerHeight;
      //test
      w > 410 ? w = 410: w = w;
      //replace this once if everything will be canvas based including the editor
      canvas.width = w < h ? w : h;
      canvas.height = w < h ? w : h;
      canvas.style.width = canvas.width+'px';
      canvas.style.height = canvas.height+'px';
      win.ctx = canvas.getContext('2d');
      //canvas.style.position='absolute';
      canvas.style.left=0;
      canvas.style.top=0;
      canvas.style.background='rgba(255,255,255,0.75)';
      //body.appendChild(canvas);
	  var grid = createElement('div');
	  grid.setAttribute('id','grid-container');
	  body.appendChild(grid);
	  grid.style.height = grid.offsetWidth+'px';
    var pheight = ((canvas.height - canvas.width) / 2) / canvas.width; 
      for (var i = 0; i < 4; i++)
      {
        for (var j = 0; j < 4; j++)
        {
		      elep= createElement('div');
		      elep.className = 'grid';
		      elep.setAttribute('id','po_'+i+'_'+j);
		      elep.setAttribute('onclick',
              'editor.showTextMenu(\''+'o_'+i+'_'+j+'\','+
              '[{\'txt\':\'set text\',\'method\':\'editor.setText(\\\''+'o_'+i+'_'+j+'\\\',null)\'},'+
              '{\'txt\':\'set order and events\',\'method\':\'editor.showOrderAndEventsPrompt(\\\''+'o_'+i+'_'+j+'\\\')\'},'+
              '{\'txt\':\'set dependencies\',\'method\':\'editor.showDependenciesPrompt(\\\''+'o_'+i+'_'+j+'\\\')\'},'+
              '{\'txt\':\'set start\',\'method\':\'editor.setStart(\\\''+'o_'+i+'_'+j+'\\\')\'},'+
              '{\'txt\':\'set stop\',\'method\':\'editor.setStop(\\\''+'o_'+i+'_'+j+'\\\')\'}'+
              ']);');
          ele = createElement('div');
          ele.className = 'grid-element';
          ele.setAttribute('id','o_'+i+'_'+j);
          //ele.setAttribute('onclick',
          //    'editor.showTextMenu(\''+'o_'+i+'_'+j+'\','+
          //    '[{\'txt\':\'set text\',\'method\':\'editor.setText(\\\''+'o_'+i+'_'+j+'\\\',null)\'},'+
          //    '{\'txt\':\'events\',\'method\':\'editor.showOrderAndEventsPrompt(\\\''+'o_'+i+'_'+j+'\\\')\'},'+
          //    '{\'txt\':\'dependencies\',\'method\':\'editor.showDependenciesPrompt(\\\''+'o_'+i+'_'+j+'\\\')\'}]);');
          ele.appendChild(createTextNode(' '+'o_'+i+'_'+j));
          //ele.appendChild(createTextNode(' '+obj.order));
          
          if (game.getObject('o_'+i+'_'+j)==null)
          {
            var obj = new GameObject('o_'+i+'_'+j, null);
            //game.objects.push({text:'',order: 0, id:ele.id, event: null});
            obj.x = 0.04 + j * 0.24;//canvas.width/40 + j * canvas.width/4.5;
            obj.y = 0.04 + i * 0.24 + pheight;//canvas.width/8 + i * canvas.width/4.5;
            obj.w = obj.h = 0.2;//canvas.width/6;
            obj.ox = obj.x;
            obj.oy = obj.y;
            game.objects.push(obj);
          }
		      elep.appendChild(ele);
          grid.appendChild(elep);
        }
        ele = createElement('br');
        ele.style.clear='both';
        grid.appendChild(ele);
      }
      //the orange output box for the current orange element
      ele = createElement('div');
      ele.setAttribute('id','output');
      body.appendChild(ele);
      for (var i = 0; i < game.objects.length; i++)
      {
        var obj = game.objects[i];
        ele = getElement(obj.id);
        if (obj.text != null && obj.text != '')
        {
          editor.setText(obj.id, obj.getText());
        }
        getElement(obj.id).appendChild(createElement('br'));
        getElement(obj.id).appendChild(createTextNode(' '+obj.order));
        getElement('ord_'+obj.id).innerHTML = '<br>';
        getElement('s_t_'+obj.id).innerHTML = '<br>';
        //initially the output box is empty
      }
      //this might be a menu button (also?)
      ele = createElement('button');
      ele.appendChild(createTextNode('set dependencies'));
      ele.setAttribute('onclick','editor.showDependenciesPrompt(\'\');');
      body.appendChild(ele);
      //place those buttons in the editor menu !
      ele = createElement('button');
      ele.appendChild(createTextNode('new game'));
      ele.setAttribute('onclick','editor.newGame();');
      body.appendChild(ele);
      ele = createElement('button');
      ele.setAttribute('id','playbutton');
      ele.appendChild(createTextNode('play'));
      ele.setAttribute('onclick','editor.showPrompt(\'Here you can play and test you game.\',\'editor.playGame(\',null);');
      body.appendChild(ele);
      //update = true;
      requestAnimationFrame(function() { updateDraw(); } );
    };

    win.game = game;
    win.editor = editor;
    window.onload = function() {setTimeout(editor.init(), 100);};
  })(window)
  </script>
 </body>
</html>